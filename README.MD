# Анализ ИсторииДанных Платформы 1С

### Анализ содержимого таблиц `_DataHistory%`  
(количество объектов и версий, размер) 


#### ***Для чего:***  
Платформа не предоставляет никакого механизма анализа количества и размера сохраненных версий, поэтому реализован отчет в SQL с добавлением вывода человекочитаемых данных.

#### ***Как это работает:***  
В базе данных доступна аналитика в разрезах:
- MetadataID - uuid медатанных
- DataID - Ключ данных (Ссылка на объект или ключ записи) 
- UserID, UserName - (пользователь 1С)

Для получения понятного представления метаданных необходимо их получить из CF или из исходников (выгрузки в файлы)

#### ***Порядок действий:***  

1. Выгружаем конфигурацию в файлы (получаем исходники).  
2. Запускаем скрипт получения сопоставления идентификаторов медатанных и их представлений  
`oscript ИдентификаторыМетаданных.os /Путь/Директории/Выгрузки`  
или  
`oscript ИдентификаторыМетаданных.os /Путь/К/Файлу/ConfigDumpInfo.xml`  

>Скрит формирует файл _СкриптВставкиМетаданных.sql_

3. Создаем таблицу хранения представлений метаданных в анализируемой БД: запускаем в sql скрипт `CreateTable.sql` 

4. Записываем в созданную таблицу представления метаданных: запускаем полученный файл со скриптом `СкриптВставкиМетаданных.sql` в анализируемой БД.

5. Анализируем данные истории версий: запускаем скрипт `Analyze.sql`  
>В зависимости от количества таблиц __DataHistoryLatestVersions_Х_ закоментировать лишние части объединения (Union_.

>В зависимости от необходимой аналитики модифицируйте последний запрос в пакете.